pipeline {
    agent any

    environment {
        EC2_INSTANCE_IP = '3.86.5.61'
        SSH_KEY = credentials('key')
    }

    stages {
        stage('SSH to EC2 Instance') {
            steps {
                
                        sh "ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no ec2-user@${EC2_INSTANCE_IP} "
                    }

                        // Pull Docker images from Docker Hub
                        sh "docker pull ${DOCKER_IMAGE_1}"
                        sh "docker pull ${DOCKER_IMAGE_2}"

                        // Run Docker containers on the new instance
                        sh '''
                            ssh -o StrictHostKeyChecking=no ec2-user@${TARGET_INSTANCE_IP_ADDRESS} '
                                docker run -d -p 3000:3000 sohilap/image1 &&
                                docker run -d -p 5000:3000 sohilap/image2
                            '
                        '''
                    }
                }
            }
        }
    


